# Setup in CircleCI account the following ENV variables:
# IS_PRODUCTION (default: 0)
# IS_ENTERPRISE
# PACKAGECLOUD_ORGANIZATION (default: stackstorm)
# PACKAGECLOUD_TOKEN
machine:
  node:
    version: 4.2.2
  environment:
    DEPLOY_PACKAGES: 1
    DEB: trusty xenial
    RPM: el6 el7
    ST2_HOST: localhost
    ST2_USERNAME: admin
    ST2_PASSWORD: 123
  services:
    - rabbitmq-server

checkout:
  pre:
    - |
        # Download helper scripts (for packagecloud)
        mkdir ~/scripts
        wget -qO - https://github.com/StackStorm/st2-packages/raw/master/.circle/packagecloud.sh > ~/scripts/packagecloud.sh
        wget -qO - https://github.com/StackStorm/st2-packages/raw/master/.circle/save_payload.py > ~/scripts/save_payload.py
        chmod 755 ~/scripts/{packagecloud.sh,save_payload.py}
        echo "export PATH=${HOME}/scripts:${PATH}" >> ~/.circlerc
dependencies:
  pre:
    - sudo apt-get install rpm
    - sudo apt-get install devscripts
    - gem install package_cloud
test:
  pre:
    - make lint
    - make packs-resource-register
    - make packs-tests

notify:
  webhooks:
  # A list of hook hashes, containing the URL field
  - url: https://hooks.slack.com/services/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
